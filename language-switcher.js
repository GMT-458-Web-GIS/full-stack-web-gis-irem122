// Language Switcher - Taste & Go WebGIS
// Supports Turkish (tr) and English (en)

const translations = {
  en: {
    // Login/Welcome page
    welcome: "Welcome to Taste & Go",
    welcomeSubtitle: "Taste, pin and share it!",
    tastePinShare: "Taste, pin and share it!",
    slogan: "Taste, pin and share it!",
    email: "Email",
    password: "Password",
    login: "Sign In",
    signIn: "Sign In",
    signUp: "Sign Up",
    register: "Sign Up",
    continueAsGuest: "Continue as Guest",
    noAccount: "Don't have an account?",
    alreadyHaveAccount: "Already have an account?",
    adminLogin: "Admin Login",
    username: "Username",
    enterUsername: "Enter your username",
    enterPassword: "Enter your password",
    managementPanel: "Management Panel",
    
    // Register page
    createAccount: "Create Account",
    confirmPassword: "Confirm Password",
    
    // Guest page
    guestMode: "Guest Mode",
    guestView: "Guest View",
    guestViewSubtitle: "Explore suggestions (Read Only)",
    backToLogin: "Back to Login",
    filterPlaces: "Filter Places",
    country: "Country",
    city: "City",
    time: "Time",
    category: "Category",
    timeSlot: "Time Slot",
    selectCountry: "Search & select country...",
    selectCity: "Select country first...",
    searchSelectCountry: "Search & select country...",
    selectCountryFirst: "Select country first...",
    allCategories: "All Categories",
    allTimes: "All Times",
    allTimeSlots: "All Time Slots",
    search: "Search",
    clear: "Clear",
    applyFilters: "Apply Filters",
    clearFilters: "Clear Filters",
    statistics: "Statistics",
    totalPlaces: "Total Places",
    showing: "Showing",
    totalMarkers: "Total Markers",
    countries: "Countries",
    cities: "Cities",
    loginToAdd: "Login to add your own suggestions!",
    
    // Categories
    foodRestaurant: "Food & Restaurant",
    eventActivity: "Event & Activity",
    food: "Food & Dining",
    cafe: "CafÃ©",
    bar: "Bar & Nightlife",
    culture: "Culture",
    nature: "Nature",
    shopping: "Shopping",
    entertainment: "Entertainment",
    
    // Time slots
    morning: "Morning",
    noon: "Noon",
    evening: "Evening",
    afternoon: "Afternoon (12:00-18:00)",
    night: "Night (00:00-06:00)",
    
    // Map/Markers
    report: "Report",
    submitReport: "Submit Report",
    cancel: "Cancel",
    reportReason: "Why are you reporting this?",
    reportSuccess: "Report submitted successfully! Admin will review it.",
    reportFailed: "Failed to submit report",
    
    // Admin
    admin: "Admin",
    adminDashboard: "Admin Dashboard",
    refresh: "Refresh",
    backToHome: "Back to Home",
    logout: "Logout",
    signOut: "Sign Out",
    generalStatistics: "General Statistics",
    generalStats: "General Statistics",
    totalPoints: "Total Points",
    activeUsers: "Active Users",
    dailyVisits: "Daily Visits",
    reports: "Reports",
    recentActivity: "Recent Activity",
    noActivityYet: "No activity yet",
    userReports: "User Reports",
    noReportsYet: "No reports yet",
    resolve: "Resolve & Delete",
    dismiss: "Dismiss",
    addPoint: "Add Point",
    deletePoint: "Delete Point",
    allPoints: "All Points",
    
    // Main app
    visitorSuggestionPlatform: "WebGIS â€” Visitor Suggestion Platform",
    addNewSuggestion: "Add New Suggestion",
    filters: "Filters",
    myMarkers: "My Markers",
    noMarkers: "No markers yet",
    edit: "Edit",
    delete: "Delete",
    
    // Form
    title: "Title",
    description: "Description",
    district: "District",
    save: "Save",
    update: "Update",
    addNewPoint: "Add New Point",
    placeName: "Place name",
    descriptionOptional: "Description (optional)",
    
    // Messages
    loading: "Loading...",
    loadingCountries: "Loading countries...",
    error: "Error",
    success: "Success",
    confirmDelete: "Are you sure you want to delete this?",
    deleteThisPoint: "Delete This Point",
    addedBy: "Added by",
    date: "Date",
    reason: "Reason",
    location: "Location",
    reportedBy: "Reported by",
    
    // Language
    language: "Language",
    turkish: "TÃ¼rkÃ§e",
    english: "English"
  },
  tr: {
    // Login/Welcome page
    welcome: "Taste & Go'ya HoÅŸ Geldiniz",
    welcomeSubtitle: "Tat, iÅŸaretle ve paylaÅŸ!",
    tastePinShare: "Tat, iÅŸaretle ve paylaÅŸ!",
    slogan: "Tat, iÅŸaretle ve paylaÅŸ!",
    email: "E-posta",
    password: "Åžifre",
    login: "GiriÅŸ Yap",
    signIn: "GiriÅŸ Yap",
    signUp: "KayÄ±t Ol",
    register: "KayÄ±t Ol",
    continueAsGuest: "Misafir Olarak Devam Et",
    noAccount: "HesabÄ±nÄ±z yok mu?",
    alreadyHaveAccount: "Zaten hesabÄ±nÄ±z var mÄ±?",
    adminLogin: "Admin GiriÅŸi",
    username: "KullanÄ±cÄ± AdÄ±",
    enterUsername: "KullanÄ±cÄ± adÄ±nÄ±zÄ± girin",
    enterPassword: "Åžifrenizi girin",
    managementPanel: "YÃ¶netim Paneli",
    
    // Register page
    createAccount: "Hesap OluÅŸtur",
    confirmPassword: "Åžifre Tekrar",
    
    // Guest page
    guestMode: "Misafir Modu",
    guestView: "Misafir GÃ¶rÃ¼nÃ¼mÃ¼",
    guestViewSubtitle: "Ã–nerileri keÅŸfedin (Sadece Okuma)",
    backToLogin: "GiriÅŸe DÃ¶n",
    filterPlaces: "MekanlarÄ± Filtrele",
    country: "Ãœlke",
    city: "Åžehir",
    time: "Zaman",
    category: "Kategori",
    timeSlot: "Zaman Dilimi",
    selectCountry: "Ãœlke ara ve seÃ§...",
    selectCity: "Ã–nce Ã¼lke seÃ§in...",
    searchSelectCountry: "Ãœlke ara ve seÃ§...",
    selectCountryFirst: "Ã–nce Ã¼lke seÃ§in...",
    allCategories: "TÃ¼m Kategoriler",
    allTimes: "TÃ¼m Zamanlar",
    allTimeSlots: "TÃ¼m Zaman Dilimleri",
    search: "Ara",
    clear: "Temizle",
    applyFilters: "Filtreleri Uygula",
    clearFilters: "Filtreleri Temizle",
    statistics: "Ä°statistikler",
    totalPlaces: "Toplam Mekan",
    showing: "GÃ¶sterilen",
    totalMarkers: "Toplam Ä°ÅŸaretÃ§i",
    countries: "Ãœlkeler",
    cities: "Åžehirler",
    loginToAdd: "Kendi Ã¶nerilerinizi eklemek iÃ§in giriÅŸ yapÄ±n!",
    
    // Categories
    foodRestaurant: "Yemek & Restoran",
    eventActivity: "Etkinlik & Aktivite",
    food: "Yemek",
    cafe: "Kafe",
    bar: "Bar & Gece HayatÄ±",
    culture: "KÃ¼ltÃ¼r",
    nature: "DoÄŸa",
    shopping: "AlÄ±ÅŸveriÅŸ",
    entertainment: "EÄŸlence",
    
    // Time slots
    morning: "Sabah",
    noon: "Ã–ÄŸle",
    evening: "AkÅŸam",
    afternoon: "Ã–ÄŸleden Sonra (12:00-18:00)",
    night: "Gece (00:00-06:00)",
    
    // Map/Markers
    report: "Åžikayet Et",
    submitReport: "Åžikayeti GÃ¶nder",
    cancel: "Ä°ptal",
    reportReason: "Åžikayet sebebiniz nedir?",
    reportSuccess: "Åžikayet baÅŸarÄ±yla gÃ¶nderildi! Admin inceleyecek.",
    reportFailed: "Åžikayet gÃ¶nderilemedi",
    
    // Admin
    admin: "Admin",
    adminDashboard: "Admin Paneli",
    refresh: "Yenile",
    backToHome: "Ana Sayfaya DÃ¶n",
    logout: "Ã‡Ä±kÄ±ÅŸ Yap",
    signOut: "Ã‡Ä±kÄ±ÅŸ Yap",
    generalStatistics: "Genel Ä°statistikler",
    generalStats: "Genel Ä°statistikler",
    totalPoints: "Toplam Nokta",
    activeUsers: "Aktif KullanÄ±cÄ±lar",
    dailyVisits: "GÃ¼nlÃ¼k Ziyaret",
    reports: "Åžikayetler",
    recentActivity: "Son Aktiviteler",
    noActivityYet: "HenÃ¼z aktivite yok",
    userReports: "KullanÄ±cÄ± Åžikayetleri",
    noReportsYet: "HenÃ¼z ÅŸikayet yok",
    resolve: "Ã‡Ã¶z ve Sil",
    dismiss: "Reddet",
    addPoint: "Nokta Ekle",
    deletePoint: "Nokta Sil",
    allPoints: "TÃ¼m Noktalar",
    
    // Main app
    visitorSuggestionPlatform: "WebGIS â€” ZiyaretÃ§i Ã–neri Platformu",
    addNewSuggestion: "Yeni Ã–neri Ekle",
    filters: "Filtreler",
    myMarkers: "Ä°ÅŸaretÃ§ilerim",
    noMarkers: "HenÃ¼z iÅŸaretÃ§i yok",
    edit: "DÃ¼zenle",
    delete: "Sil",
    
    // Form
    title: "BaÅŸlÄ±k",
    description: "AÃ§Ä±klama",
    district: "Ä°lÃ§e",
    save: "Kaydet",
    update: "GÃ¼ncelle",
    addNewPoint: "Yeni Nokta Ekle",
    placeName: "Mekan adÄ±",
    descriptionOptional: "AÃ§Ä±klama (isteÄŸe baÄŸlÄ±)",
    
    // Messages
    loading: "YÃ¼kleniyor...",
    loadingCountries: "Ãœlkeler yÃ¼kleniyor...",
    error: "Hata",
    success: "BaÅŸarÄ±lÄ±",
    confirmDelete: "Bunu silmek istediÄŸinizden emin misiniz?",
    deleteThisPoint: "Bu NoktayÄ± Sil",
    addedBy: "Ekleyen",
    date: "Tarih",
    reason: "Sebep",
    location: "Konum",
    reportedBy: "Åžikayet Eden",
    
    // Language
    language: "Dil",
    turkish: "TÃ¼rkÃ§e",
    english: "English"
  }
};

// Get current language from localStorage or default to English
function getCurrentLanguage() {
  return localStorage.getItem('appLanguage') || 'en';
}

// Set language and save to localStorage
function setLanguage(lang) {
  localStorage.setItem('appLanguage', lang);
  applyTranslations();
  updateLanguageSwitcher();
}

// Get translation for a key
function t(key) {
  const lang = getCurrentLanguage();
  return translations[lang][key] || translations['en'][key] || key;
}

// Apply translations to all elements with data-i18n attribute
function applyTranslations() {
  const lang = getCurrentLanguage();
  
  // Update document language attribute
  document.documentElement.lang = lang === 'tr' ? 'tr' : 'en';
  
  // Translate elements with data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    const translation = translations[lang][key] || translations['en'][key];
    if (translation) {
      if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
        // Don't change input values, only placeholders
      } else {
        el.textContent = translation;
      }
    }
  });
  
  // Translate placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    const translation = translations[lang][key] || translations['en'][key];
    if (translation) {
      el.placeholder = translation;
    }
  });
  
  // Translate titles/tooltips
  document.querySelectorAll('[data-i18n-title]').forEach(el => {
    const key = el.getAttribute('data-i18n-title');
    const translation = translations[lang][key] || translations['en'][key];
    if (translation) {
      el.title = translation;
    }
  });
  
  // Update page title based on current page
  updatePageTitle();
}

// Update page title based on language
function updatePageTitle() {
  const lang = getCurrentLanguage();
  const path = window.location.pathname;
  
  if (path.includes('login')) {
    document.title = lang === 'tr' ? 'Taste & Go - GiriÅŸ' : 'Taste & Go - Login';
  } else if (path.includes('auth')) {
    document.title = lang === 'tr' ? 'Taste & Go - GiriÅŸ / KayÄ±t' : 'Taste & Go - Login / Register';
  } else if (path.includes('guest')) {
    document.title = lang === 'tr' ? 'Taste & Go - Misafir GÃ¶rÃ¼nÃ¼mÃ¼' : 'Taste & Go - Guest View';
  } else if (path.includes('admin-dashboard')) {
    document.title = lang === 'tr' ? 'Admin Paneli - Taste & Go' : 'Admin Dashboard - Taste & Go';
  } else if (path.includes('admin-login')) {
    document.title = lang === 'tr' ? 'Admin GiriÅŸi - Taste & Go' : 'Admin Login - Taste & Go';
  } else if (path.includes('map')) {
    document.title = lang === 'tr' ? 'Taste & Go - Harita' : 'Taste & Go - Map';
  }
}

// Update language switcher button display
function updateLanguageSwitcher() {
  const lang = getCurrentLanguage();
  const btn = document.getElementById('lang-switcher-btn');
  if (btn) {
    btn.innerHTML = lang === 'tr' 
      ? 'ðŸ‡¹ðŸ‡· TR' 
      : 'ðŸ‡¬ðŸ‡§ EN';
  }
  
  // Update active state in dropdown
  document.querySelectorAll('.lang-option').forEach(opt => {
    opt.classList.remove('active');
    if (opt.getAttribute('data-lang') === lang) {
      opt.classList.add('active');
    }
  });
}

// Create and inject language switcher UI
function createLanguageSwitcher() {
  // Remove existing if any
  const existing = document.getElementById('language-switcher');
  if (existing) existing.remove();
  
  const switcher = document.createElement('div');
  switcher.id = 'language-switcher';
  switcher.innerHTML = `
    <style>
      #language-switcher {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 99999;
        font-family: 'Google Sans', -apple-system, sans-serif;
      }
      #lang-switcher-btn {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 25px;
        padding: 10px 16px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        color: #333;
      }
      #lang-switcher-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }
      #lang-dropdown {
        position: absolute;
        bottom: 100%;
        right: 0;
        margin-bottom: 8px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        display: none;
        min-width: 150px;
      }
      #lang-dropdown.show {
        display: block;
        animation: slideUp 0.2s ease;
      }
      @keyframes slideUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .lang-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 16px;
        cursor: pointer;
        transition: background 0.2s;
        font-size: 14px;
        color: #333;
      }
      .lang-option:hover {
        background: #f5f5f5;
      }
      .lang-option.active {
        background: #FF4A1C;
        color: white;
      }
      .lang-flag {
        font-size: 20px;
      }
    </style>
    <div id="lang-dropdown">
      <div class="lang-option" data-lang="en">
        <span class="lang-flag">ðŸ‡¬ðŸ‡§</span>
        <span>English</span>
      </div>
      <div class="lang-option" data-lang="tr">
        <span class="lang-flag">ðŸ‡¹ðŸ‡·</span>
        <span>TÃ¼rkÃ§e</span>
      </div>
    </div>
    <button id="lang-switcher-btn" type="button">
      ðŸ‡¬ðŸ‡§ EN
    </button>
  `;
  
  document.body.appendChild(switcher);
  
  // Event listeners
  const btn = document.getElementById('lang-switcher-btn');
  const dropdown = document.getElementById('lang-dropdown');
  
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdown.classList.toggle('show');
  });
  
  document.querySelectorAll('.lang-option').forEach(opt => {
    opt.addEventListener('click', (e) => {
      e.stopPropagation();
      const lang = opt.getAttribute('data-lang');
      setLanguage(lang);
      dropdown.classList.remove('show');
      
      // Reload page to fully apply translations
      window.location.reload();
    });
  });
  
  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('#language-switcher')) {
      dropdown.classList.remove('show');
    }
  });
  
  // Set initial state
  updateLanguageSwitcher();
}

// Initialize on DOM ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}

function init() {
  createLanguageSwitcher();
  applyTranslations();
}

// Export for use in other scripts
window.LanguageSwitcher = {
  t,
  getCurrentLanguage,
  setLanguage,
  applyTranslations,
  translations
};
