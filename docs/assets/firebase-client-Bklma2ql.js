import{f as w}from"./firebase-config-DxLbwtvt.js";import{getApps as f,initializeApp as p}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";import{getAuth as d}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";import{getDatabase as h,ref as s,get as R,update as u,push as m,set as l,onValue as A}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";const S=f().length?f()[0]:p(w),g=d(S),i=h(S);async function I(t){try{if(!g.currentUser)throw new Error("UNAUTHENTICATED");const e=s(i,"suggestions"),r=m(e),o=new Date().toISOString();return await l(r,{title:t.title||"",description:t.description||"",lat:t.lat||0,lng:t.lng||0,country:t.country||"",city:t.city||"",timeSlot:t.timeSlot||"",category:t.category||"",createdBy:g.currentUser.uid,createdAt:o,updatedAt:o,visibility:"public",flags:[]}),r}catch(e){throw console.error("createSuggestion error:",e),e}}async function O(t,e){try{const r=s(i,`suggestions/${t}`),o=new Date().toISOString();await u(r,{...e,updatedAt:o})}catch(r){throw console.error("updateSuggestion error:",r),r}}async function C(t){try{const e=s(i,`suggestions/${t}`),r=new Date().toISOString();await u(e,{visibility:"hidden",updatedAt:r})}catch(e){throw console.error("deleteSuggestion error:",e),e}}async function $(t,e=""){var r;try{const o=s(i,`suggestions/${t}/flags`),c=m(o),a=new Date().toISOString();await l(c,{by:((r=g.currentUser)==null?void 0:r.uid)||null,reason:e,at:a})}catch(o){throw console.error("flagSuggestion error:",o),o}}function v(t={},e){try{const r=s(i,"suggestions");return A(r,o=>{if(!o.exists()){e([]);return}const c=o.val(),a=Object.entries(c).map(([n,y])=>({id:n,...y})).filter(n=>n.visibility==="public").filter(n=>!t.country||(n.country||"").toLowerCase().includes(t.country.toLowerCase())).filter(n=>!t.city||(n.city||"").toLowerCase().includes(t.city.toLowerCase())).filter(n=>!t.timeSlot||n.timeSlot===t.timeSlot).filter(n=>!t.category||n.category===t.category);e(a)},o=>{console.error("getSuggestions error:",o),e([])})}catch(r){return console.error("getSuggestions error:",r),e([]),()=>{}}}async function x(t,e="contributor"){try{if(!t||!t.uid)return;const r=s(i,`users/${t.uid}`),o=new Date().toISOString();await l(r,{email:t.email||null,createdAt:o,lastLogin:o,role:e},{merge:!0})}catch(r){console.warn("createUserProfile error:",r)}}async function E(t){try{if(!t)return;const e=s(i,`users/${t}`),r=new Date().toISOString();await u(e,{lastLogin:r})}catch(e){console.warn("updateLastLogin error:",e)}}async function T(t){try{if(!t)return null;const e=s(i,`users/${t}`),r=await R(e);return r.exists()&&r.val().role||null}catch(e){return console.warn("getUserRole error:",e),null}}export{g as auth,I as createSuggestion,x as createUserProfile,i as db,C as deleteSuggestion,$ as flagSuggestion,v as getSuggestions,T as getUserRole,E as updateLastLogin,O as updateSuggestion};
