const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-client-Bklma2ql.js","assets/firebase-config-DxLbwtvt.js","assets/main-DHt8C1BT.js","assets/main-CIGW-MKW.css","assets/style-BJLvbmFw.css"])))=>i.map(i=>d[i]);
import"./firebase-config-DxLbwtvt.js";/* empty css              */import{_ as ye}from"./preload-helper-BmvMH90o.js";import*as k from"https://unpkg.com/leaflet@1.9.4/dist/leaflet-src.esm.js";import{auth as le,getUserRole as Ce,updateLastLogin as He,createSuggestion as Oe,getSuggestions as ke,flagSuggestion as Fe}from"./firebase-client-Bklma2ql.js";import{signOut as Ge,onAuthStateChanged as Se}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";import"https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";function Be(){const H=document.getElementById("map");if(!H){console.error('Element with id="map" not found. Add <div id="map"></div> to your HTML.');return}let g=null,I=null;delete k.Icon.Default.prototype._getIconUrl,k.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});const d=k.map(H,{zoomControl:!1}).setView([39.925533,32.866287],6),fe=k.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:""}),se=k.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:""});k.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{maxZoom:19,attribution:""}),se.addTo(d);let Y="satellite";const m=document.createElement("button");m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;"><path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498 4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 0 0-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0Z" /></svg>',m.title="Switch Map Layer",Object.assign(m.style,{position:"absolute",left:"20px",bottom:"20px",zIndex:2e3,width:"50px",height:"50px",border:"none",borderRadius:"50%",background:"#FF4A1C",color:"white",fontSize:"18px",fontWeight:"600",cursor:"pointer",fontFamily:'"Google Sans", sans-serif',transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"}),m.classList.add("glass"),document.body.appendChild(m);const F=document.createElement("div");Object.assign(F.style,{position:"absolute",left:"20px",bottom:"80px",zIndex:2100,display:"none",minWidth:"160px",padding:"15px",fontFamily:'"Google Sans", sans-serif',background:"rgba(255,255,255,0.95)",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.15)"}),F.innerHTML=`
    <div style="font-weight:600;margin-bottom:10px;color:#565656;font-size:14px">Map Layers</div>
    <div style="display:flex;flex-direction:column;gap:8px">
      <button id="layer-satellite" style="padding:10px;border:none;border-radius:8px;background:#FF4A1C;color:white;cursor:pointer;font-family:'Google Sans',sans-serif;font-weight:500">Satellite</button>
      <button id="layer-osm" style="padding:10px;border:none;border-radius:8px;background:#565656;color:white;cursor:pointer;font-family:'Google Sans',sans-serif;font-weight:500">OpenStreetMap</button>
    </div>
  `,document.body.appendChild(F),m.addEventListener("mouseenter",()=>{m.style.background="#B2FFA9",m.style.color="#565656",m.style.transform="scale(1.1)"}),m.addEventListener("mouseleave",()=>{m.style.background="#FF4A1C",m.style.color="white",m.style.transform="scale(1)"}),m.addEventListener("click",t=>{t.stopPropagation(),F.style.display=F.style.display==="none"?"block":"none"}),document.body.addEventListener("click",t=>{!F.contains(t.target)&&t.target!==m&&(F.style.display="none")}),setTimeout(()=>{const t=document.getElementById("layer-satellite"),e=document.getElementById("layer-osm");t&&t.addEventListener("click",()=>{Y!=="satellite"&&(d.removeLayer(fe),se.addTo(d),Y="satellite",t.style.background="#FF4A1C",e.style.background="#565656"),F.style.display="none"}),e&&e.addEventListener("click",()=>{Y!=="osm"&&(d.removeLayer(se),fe.addTo(d),Y="osm",e.style.background="#FF4A1C",t.style.background="#565656"),F.style.display="none"})},100);const M=document.createElement("div");M.className="filter-panel",M.innerHTML=`
    <div class="panel-header">
      <h3>Filters</h3>
      <div class="tabs">
        <button id="tab-filters" class="tab-btn active">Filter</button>
        <button id="tab-search" class="tab-btn">Search</button>
      </div>
    </div>
    <div id="tab-content-filters" class="tab-content">
      <div class="filter-group">
        <label class="filter-label">Location</label>
        <select id="f-country" class="filter-select">
          <option value="">All Countries</option>
        </select>
        <select id="f-city" class="filter-select">
          <option value="">All Cities</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Time</label>
        <select id="f-time" class="filter-select">
          <option value="">All Times</option>
          <option value="morning">Morning</option>
          <option value="noon">Noon</option>
          <option value="evening">Evening</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Category</label>
        <select id="f-cat" class="filter-select">
          <option value="">All Categories</option>
          <option value="food">Food</option>
          <option value="event">Event</option>
        </select>
      </div>
      <div class="filter-actions">
        <button id="apply-f" class="btn-primary">Apply Filters</button>
        <button id="clear-f" class="btn-secondary">Clear All</button>
      </div>
    </div>
    <div id="tab-content-search" class="tab-content" style="display:none">
      <div class="search-group">
        <label class="filter-label">Search Location</label>
        <input id="search-query" placeholder="Enter address or region..." class="search-input"/>
      </div>
      <div id="search-results" class="search-results"></div>
    </div>
  `,document.body.appendChild(M),M.style.display="block",Object.assign(M.style,{position:"absolute",left:"20px",top:"80px",zIndex:1200,padding:"15px",minWidth:"200px",maxWidth:"25vw",fontFamily:'"Google Sans", sans-serif'}),M.classList.add("glass");const Z=document.createElement("nav");Object.assign(Z.style,{position:"fixed",top:"0",left:"0",right:"0",height:"60px",zIndex:3e3,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 20px",background:"#FF4A1C",boxShadow:"0 2px 20px rgba(0,0,0,0.15)"});const K=document.createElement("div");Object.assign(K.style,{display:"flex",alignItems:"center",gap:"12px"});const O=document.createElement("img");O.src="/logo.png",O.alt="Taste & Go",O.onerror=function(){this.style.display="none",G.style.display="block"},Object.assign(O.style,{height:"40px",width:"auto"});const G=document.createElement("span");G.textContent="Taste & Go",G.style.display="none",Object.assign(G.style,{fontSize:"1.5rem",fontWeight:"700",color:"white",fontFamily:'"Google Sans", sans-serif'}),K.appendChild(O),K.appendChild(G),Z.appendChild(K);const de=document.createElement("div");Object.assign(de.style,{display:"flex",alignItems:"center",gap:"15px"});const z=document.createElement("div");Object.assign(z.style,{display:"flex",gap:"12px",alignItems:"center"});const w=document.createElement("button");w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 20px; height: 20px;"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" /></svg>',Object.assign(w.style,{width:"44px",height:"44px",border:"none",borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",color:"white",fontSize:"18px",cursor:"pointer",fontFamily:'"Google Sans", sans-serif',transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"});const E=document.createElement("button");E.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 22px; height: 22px;"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" /></svg>',E.title="Add new event",Object.assign(E.style,{width:"44px",height:"44px",border:"none",borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",color:"white",fontSize:"18px",cursor:"pointer",fontFamily:'"Google Sans", sans-serif',transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"}),z.appendChild(w),z.appendChild(E),z.style.display="none",de.appendChild(z),w.addEventListener("mouseenter",()=>{w.style.background="rgba(255, 255, 255, 0.4)",w.style.transform="scale(1.1)"}),w.addEventListener("mouseleave",()=>{w.style.background="rgba(255, 255, 255, 0.2)",w.style.transform="scale(1)"}),E.addEventListener("mouseenter",()=>{E.style.background="rgba(255, 255, 255, 0.4)",E.style.transform="scale(1.1)"}),E.addEventListener("mouseleave",()=>{E.style.background="rgba(255, 255, 255, 0.2)",E.style.transform="scale(1)"});const A=document.createElement("div");Object.assign(A.style,{position:"fixed",right:"20px",top:"70px",zIndex:3100,display:"none",minWidth:"200px",padding:"20px",fontFamily:'"Google Sans", sans-serif',background:"rgba(255,255,255,0.98)",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.15)"}),A.innerHTML=`
  <div id="profile-info" style="margin-bottom:20px;"></div>
  <button id="logout-btn" style="
    width:100%;
    padding:12px;
    border:none;
    border-radius:12px;
    background:#FF4A1C;
    color:white;
    font-family:'Google Sans', sans-serif;
    font-weight:500;
    font-size:14px;
    cursor:pointer;
    transition:all 0.3s ease;
  ">
    Sign Out
  </button>
`,document.body.appendChild(A),w.addEventListener("click",t=>{t.stopPropagation(),A.style.display=A.style.display==="none"?"block":"none";const e=A.querySelector("#profile-info"),o=g;o&&o.email?e.innerHTML=`
        <div><strong>Email:</strong> ${o.email}</div>
        <div style="opacity:0.7">
          UID: ${o.uid.slice(0,8)}...
        </div>
      `:o?e.innerHTML="<div>No email info</div>":e.innerHTML='<div><strong>User</strong></div><div style="opacity:0.7">Logged in</div>'});const L=A.querySelector("#logout-btn");L&&(L.addEventListener("mouseenter",()=>{L.style.background="#E03F15",L.style.transform="translateY(-2px)",L.style.boxShadow="0 4px 12px rgba(255,74,28,0.3)"}),L.addEventListener("mouseleave",()=>{L.style.background="#FF4A1C",L.style.transform="translateY(0)",L.style.boxShadow="none"}),L.addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation();try{localStorage.removeItem("loggedIn"),localStorage.removeItem("guest")}catch{}await Ge(le)})),Z.appendChild(de),document.body.appendChild(Z);const P=document.createElement("div");Object.assign(P.style,{position:"fixed",right:"20px",bottom:"20px",zIndex:2e3,display:"flex",flexDirection:"column",gap:"8px",padding:"8px"}),P.classList.add("glass");const f=document.createElement("button");f.innerText="+",Object.assign(f.style,{width:"50px",height:"50px",fontSize:"24px",fontWeight:"600",border:"none",borderRadius:"50%",background:"#FF4A1C",color:"white",cursor:"pointer",fontFamily:'"Google Sans", sans-serif',transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"});const v=document.createElement("button");v.innerText="‚àí",Object.assign(v.style,{width:"50px",height:"50px",fontSize:"24px",fontWeight:"600",border:"none",borderRadius:"50%",background:"#FF4A1C",color:"white",cursor:"pointer",fontFamily:'"Google Sans", sans-serif',transition:"all 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center"}),P.appendChild(v),P.appendChild(f),document.body.appendChild(P),f.addEventListener("click",()=>d.zoomIn()),v.addEventListener("click",()=>d.zoomOut()),f.addEventListener("mouseenter",()=>{f.style.background="#B2FFA9",f.style.color="#565656",f.style.transform="scale(1.1)"}),f.addEventListener("mouseleave",()=>{f.style.background="#FF4A1C",f.style.color="white",f.style.transform="scale(1)"}),v.addEventListener("mouseenter",()=>{v.style.background="#B2FFA9",v.style.color="#565656",v.style.transform="scale(1.1)"}),v.addEventListener("mouseleave",()=>{v.style.background="#FF4A1C",v.style.color="white",v.style.transform="scale(1)"}),M.querySelectorAll("label, select, input, button").forEach(t=>{t.tagName.toLowerCase()==="button"?Object.assign(t.style,{background:"#FF4A1C",color:"white",border:"none",borderRadius:"8px",padding:"8px 16px",fontFamily:'"Google Sans", sans-serif',fontWeight:"500",cursor:"pointer",transition:"all 0.3s ease"}):Object.assign(t.style,{background:"rgba(255,255,255,0.9)",border:"1px solid rgba(86,86,86,0.2)",padding:"8px 12px",borderRadius:"8px",fontFamily:'"Google Sans", sans-serif',fontSize:"14px",color:"#565656"})});const S=document.getElementById("f-country"),y=document.getElementById("f-city"),ve=document.getElementById("f-time"),be=document.getElementById("f-cat"),Ie=document.getElementById("apply-f"),Ae=document.getElementById("clear-f"),U=document.getElementById("tab-filters"),N=document.getElementById("tab-search"),Q=document.getElementById("tab-content-filters"),J=document.getElementById("tab-content-search"),$=document.getElementById("search-query"),he=document.getElementById("search-btn"),xe=document.getElementById("clear-search"),B=document.getElementById("search-results");U&&U.addEventListener("click",()=>{Q&&(Q.style.display=""),J&&(J.style.display="none"),U.classList.add("active"),N&&N.classList.remove("active")}),N&&N.addEventListener("click",()=>{Q&&(Q.style.display="none"),J&&(J.style.display=""),U&&U.classList.remove("active"),N.classList.add("active")});let _={},W={},X={},C={},ce=null;async function Te(){S.innerHTML='<option value="">Loading countries...</option>';try{const o=(await(await fetch("https://restcountries.com/v3.1/all?fields=name,cca2,latlng")).json()).filter(n=>n.cca2&&n.name&&n.name.common).map(n=>({code:n.cca2,name:n.name.common,latlng:n.latlng||null})).sort((n,i)=>n.name.localeCompare(i));S.innerHTML='<option value="">All Countries</option>',o.forEach(n=>{_[n.code.toLowerCase()]={name:n.name,latlng:n.latlng};const i=document.createElement("option");i.value=n.code.toLowerCase(),i.textContent=n.name,S.appendChild(i)}),console.log(`Loaded ${o.length} countries successfully`);try{const i=await(await fetch("https://countriesnow.space/api/v0.1/countries")).json();i&&i.data&&Array.isArray(i.data)&&(i.data.forEach(a=>{if(a.country&&Array.isArray(a.cities)){W[a.country]=a.cities.slice();const r=pe(a.country);X[r]=a.country}}),console.log(`Loaded cities for ${Object.keys(W).length} countries`))}catch(n){console.warn("Failed to load countriesnow city list",n)}}catch(t){console.error("Failed to load countries",t),S.innerHTML='<option value="">Failed to load countries</option>'}}function pe(t){if(!t)return"";try{return t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9 ]+/g,"").trim()}catch{return t.toString().toLowerCase()}}function Me(t){if(y.innerHTML="<option>Loading...</option>",!t){y.innerHTML='<option value="">All Cities</option>';return}const e=_[t],o=e?e.name:null;if(!o){y.innerHTML="<option>(Country name not found)</option>";return}let n=W[o];if(!n||n.length===0){const i=pe(o),a=X[i];a&&(n=W[a])}if((!n||n.length===0)&&o){const i=pe(o),a=Object.keys(X).find(r=>r.includes(i)||i.includes(r));if(a){const r=X[a];n=W[r]}}if(!n||n.length===0){y.innerHTML="<option>(City list not found - use search tab)</option>";return}y.innerHTML='<option value="">All Cities</option>',n.sort((i,a)=>i.localeCompare(a)).forEach(i=>{const a=document.createElement("option");a.value=i,a.textContent=i,y.appendChild(a)})}async function ze(t,e){const o=e?`${t}, ${e}`:t;console.log(`[pre-review] City selected => city: "${t}", country: "${e}", geocode query: "${o}"`);try{const n=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(o)}&limit=1&addressdetails=1`;console.log("[pre-review] Fetching Nominatim URL:",n);const i=await fetch(n,{headers:{"Accept-Language":"tr"}});if(!i.ok)throw console.error("[pre-review] Nominatim response not ok",i.status,i.statusText),new Error("Geocode failed");const a=await i.json();if(console.log("[pre-review] Nominatim geocode result:",a),!a||a.length===0){alert("Could not find coordinates for this city.");return}const r=a[0];if(r.boundingbox&&r.boundingbox.length===4){const l=parseFloat(r.boundingbox[0]),u=parseFloat(r.boundingbox[1]),c=parseFloat(r.boundingbox[2]),h=parseFloat(r.boundingbox[3]),s=k.latLngBounds([[l,c],[u,h]]);console.log(`[pre-review] Will fitBounds to bbox: south=${l}, west=${c}, north=${u}, east=${h}`,s),d.fitBounds(s)}else if(r.lat&&r.lon){const l=parseFloat(r.lat),u=parseFloat(r.lon);console.log(`[pre-review] Will setView to lat=${l}, lon=${u}, zoom=12`),d.setView([l,u],12)}else console.warn("[pre-review] Geocode result missing coords/bbox",r)}catch(n){console.error("City geocode error",n),alert("Could not get city coordinates.")}}S.addEventListener("change",async()=>{const t=S.value;if(t){const e=_[t];e&&e.latlng&&e.latlng.length===2&&d.setView([e.latlng[0],e.latlng[1]],6),Me(t)}else y.innerHTML="<option>Select country first</option>"}),y.addEventListener("change",()=>{const t=String(y.value||"").trim();if(!t)return;const e=S.value,o=e&&_[e]?_[e].name:"";ze(t,o)});async function we(t){if(B.innerHTML="Searching...",!t||!t.trim()){B.innerHTML="<div>Search term is empty</div>";return}try{const e=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=10&addressdetails=1&extratags=0`,n=await(await fetch(e,{headers:{"Accept-Language":"tr"}})).json();if(!n||n.length===0){B.innerHTML="<div>No results found</div>";return}B.innerHTML="",n.forEach((i,a)=>{const r=document.createElement("div");r.style.padding="6px",r.style.borderBottom="1px solid #eee",r.style.cursor="pointer",r.textContent=i.display_name,r.addEventListener("click",()=>{if(i.boundingbox&&i.boundingbox.length===4){const l=parseFloat(i.boundingbox[0]),u=parseFloat(i.boundingbox[1]),c=parseFloat(i.boundingbox[2]),h=parseFloat(i.boundingbox[3]),s=k.latLngBounds([[l,c],[u,h]]);d.fitBounds(s)}else i.lat&&i.lon&&d.setView([parseFloat(i.lat),parseFloat(i.lon)],12)}),B.appendChild(r)})}catch(e){console.error("Search error",e),B&&(B.innerHTML="<div>An error occurred during search</div>")}}he&&he.addEventListener("click",()=>we($.value)),xe&&xe.addEventListener("click",()=>{$&&($.value=""),B&&(B.innerHTML="")}),$&&$.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),we($.value))}),Te().catch(()=>{});function je(t){Object.values(C).forEach(e=>d.removeLayer(e)),C={},t.forEach(e=>{const o=k.marker([e.lat,e.lng]).addTo(d),n=document.createElement("div");n.innerHTML=`<strong>${j(e.title)}</strong><br/><em>${j(e.city||"")}, ${j(e.country||"")}</em>
        <div style="font-size:12px;margin-top:6px">${j(e.timeSlot||"")} / ${j(e.category||"")}</div>`;const i=document.createElement("button");i.textContent="Report",i.style.marginTop="8px",i.addEventListener("click",async()=>{if(!le.currentUser){confirm("You must sign in to report. Go to login page?")&&(window.location.href="/auth.html");return}try{await Fe(e.id,"Inappropriate content"),alert("Report submitted.")}catch(a){console.error(a),alert("Failed to submit report.")}}),n.appendChild(document.createElement("hr")),n.appendChild(i),o.bindPopup(n),C[e.id]=o})}function ue(t={}){typeof ce=="function"&&ce(),ce=ke(t,je)}ue({}),Ie.addEventListener("click",()=>{ue({country:S.value.trim(),city:y.options[y.selectedIndex]?y.options[y.selectedIndex].text:"",timeSlot:ve.value,category:be.value})}),Ae.addEventListener("click",()=>{S.value="",y.innerHTML="<option>√ñnce √ºlke se√ßin</option>",ve.value="",be.value="",ue({})}),Se(le,async t=>{if(g=t,t)try{I=await Ce(t.uid),await He(t.uid)}catch(e){console.error("Failed to fetch role on auth change",e),I=null}else I=null;g?(me(),p&&(p.style.display=""),q(),z.style.display="flex"):(p&&(p.style.display="none"),ge(),z.style.display="none",A.style.display="none")});let T=!1,b=null;async function Re(t,e){try{const o=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${encodeURIComponent(t)}&lon=${encodeURIComponent(e)}&addressdetails=1`;console.log("[reverse geocode] URL:",o);const n=await fetch(o,{headers:{"Accept-Language":"tr"}});if(!n.ok)return console.warn("reverse geocode failed",n.status),null;const a=(await n.json()).address||{},r=a.city||a.town||a.village||a.hamlet||"",l=a.country||"";return console.log("[reverse geocode] result:",{country:l,city:r}),{country:l,city:r}}catch(o){return console.warn("reverseGeocodeLatLng error",o),null}}const ee=document.querySelector('button[title="Add new event"]');ee&&(ee.addEventListener("click",()=>{if(!g){confirm("You must sign in to add events. Go to login page?")&&(window.location.href="/auth.html?mode=login");return}T=!T,ee.style.background=T?"rgba(255, 200, 87, 0.9)":"rgba(255, 255, 255, 0.2)",ee.title=T?"Click on map to add event (click again to cancel)":"Add new event",T?alert("Add mode enabled. Click on the map to place an event marker."):b&&(d.removeLayer(b),b=null)}),d.on("click",async t=>{if(!T||!g)return;const{lat:e,lng:o}=t.latlng;b&&d.removeLayer(b),b=k.marker([e,o]).addTo(d);const n=await Re(e,o);$e(e,o,n)}));function $e(t,e,o){if(!g){confirm("You must sign in to save. Go to login page?")&&(window.location.href="/auth.html");return}const n=(o==null?void 0:o.country)||"",i=(o==null?void 0:o.city)||"",a=document.getElementById("add-event-panel");a&&a.remove();const r=document.createElement("div");r.id="add-event-panel",Object.assign(r.style,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",padding:"24px",borderRadius:"16px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",zIndex:1e4,minWidth:"450px",maxWidth:"90vw",maxHeight:"90vh",overflowY:"auto",fontFamily:"Google Sans, sans-serif"}),r.innerHTML=`
      <h3 style="margin:0 0 20px 0;color:#FF4A1C;font-size:24px;">Add New Event</h3>
      
      <div style="margin-bottom:16px;">
        <label style="display:block;margin-bottom:6px;font-weight:600;color:#333;">Event Title *</label>
        <input id="event-title" type="text" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;" placeholder="Enter event name">
      </div>

      <div style="margin-bottom:16px;">
        <label style="display:block;margin-bottom:6px;font-weight:600;color:#333;">Description</label>
        <textarea id="event-description" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;min-height:80px;resize:vertical;" placeholder="Event details (optional)"></textarea>
      </div>

      <div style="margin-bottom:16px;">
        <label style="display:block;margin-bottom:6px;font-weight:600;color:#333;">Category</label>
        <select id="event-category" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;">
          <option value="food">üçΩÔ∏è Food & Dining</option>
          <option value="event">üéâ Event & Entertainment</option>
          <option value="culture">üèõÔ∏è Culture & History</option>
          <option value="nature">üåø Nature & Outdoors</option>
          <option value="shopping">üõçÔ∏è Shopping</option>
          <option value="nightlife">üåô Nightlife</option>
          <option value="sports">‚öΩ Sports & Recreation</option>
          <option value="other">üìå Other</option>
        </select>
      </div>

      <div style="margin-bottom:16px;">
        <label style="display:block;margin-bottom:6px;font-weight:600;color:#333;">Best Time to Visit</label>
        <select id="event-timeslot" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;">
          <option value="morning">üåÖ Morning (6am-12pm)</option>
          <option value="noon">‚òÄÔ∏è Afternoon (12pm-5pm)</option>
          <option value="evening">üåÜ Evening (5pm-9pm)</option>
          <option value="night">üåô Night (9pm-6am)</option>
          <option value="anytime">‚è∞ Anytime</option>
        </select>
      </div>

      <div style="margin-bottom:16px;">
        <label style="display:block;margin-bottom:6px;font-weight:600;color:#333;">Location</label>
        <input type="text" value="${i?i+", ":""}${n}" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;background:#f5f5f5;font-size:14px;" readonly>
      </div>

      <div style="margin-bottom:20px;padding:10px;background:#f8f9fa;border-radius:8px;font-size:12px;color:#666;">
        <strong>üìç Coordinates:</strong> ${t.toFixed(6)}, ${e.toFixed(6)}
      </div>

      <div style="display:flex;gap:10px;">
        <button id="save-event-btn" style="flex:1;padding:12px;background:#FF4A1C;color:white;border:none;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.3s;">
          Save Event
        </button>
        <button id="cancel-event-btn" style="flex:1;padding:12px;background:#e0e0e0;color:#333;border:none;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.3s;">
          Cancel
        </button>
      </div>
    `,document.body.appendChild(r);const l=document.getElementById("save-event-btn"),u=document.getElementById("cancel-event-btn");l.addEventListener("mouseenter",()=>{l.style.background="#E03F15",l.style.transform="translateY(-2px)",l.style.boxShadow="0 4px 12px rgba(255,74,28,0.3)"}),l.addEventListener("mouseleave",()=>{l.style.background="#FF4A1C",l.style.transform="translateY(0)",l.style.boxShadow="none"}),u.addEventListener("mouseenter",()=>{u.style.background="#d0d0d0"}),u.addEventListener("mouseleave",()=>{u.style.background="#e0e0e0"}),l.addEventListener("click",async()=>{const c=document.getElementById("event-title").value.trim();if(!c){alert("Please enter an event title");return}const h={title:c,description:document.getElementById("event-description").value.trim(),category:document.getElementById("event-category").value,timeSlot:document.getElementById("event-timeslot").value,lat:t,lng:e,country:n,city:i};try{await Oe(h),alert("Event saved successfully!"),r.remove(),b&&(d.removeLayer(b),b=null),T=!1;const s=document.querySelector('button[title*="event"]');s&&(s.style.background="#B2FFA9",s.style.color="#565656",s.title="Add new event")}catch(s){console.error("Save error:",s),alert("Failed to save event: "+(s.message||"Unknown error"))}}),u.addEventListener("click",()=>{r.remove(),b&&(d.removeLayer(b),b=null),T=!1;const c=document.querySelector('button[title*="event"]');c&&(c.style.background="#B2FFA9",c.style.color="#565656",c.title="Add new event")})}function j(t){return t?String(t).replace(/[&<>"'`]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"})[e]):""}let te=null,p=null,V=null;function me(){if(p)return;p=document.createElement("div"),p.className="right-panel",Object.assign(p.style,{position:"absolute",left:"20px",top:"550px",height:"50vh",width:"240px",maxWidth:"56vw",background:"rgba(255,255,255,0.98)",padding:"10px",borderRadius:"8px",boxShadow:"0 2px 12px rgba(0,0,0,0.15)",overflowY:"auto",zIndex:2e3,fontSize:"14px"}),p.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong>Added Places</strong>
      <button id="panel-refresh" title="Refresh" style="font-size:12px">R</button>
    </div><div id="panel-list" style="display:flex;flex-direction:column;gap:8px"></div>`,document.body.appendChild(p),V=document.getElementById("panel-list"),p.querySelector("#panel-refresh").addEventListener("click",()=>{g&&q()})}function ge(){if(typeof te=="function"){try{te()}catch{}te=null}}function q(){me(),ge(),te=ke({},t=>{if(!g){Ee([]);return}const e=g.uid;let o=t||[];I!=="admin"&&(o=o.filter(n=>n.createdBy&&n.createdBy===e||n.ownerId&&n.ownerId===e||n.authorUid&&n.authorUid===e)),Ee(o)})}function Ee(t){if(p&&(p.style.display=g?"":"none",!!V)){if(V.innerHTML="",!t||t.length===0){const e=document.createElement("div");e.textContent="No items to display",e.style.color="#666",V.appendChild(e);return}t.forEach(e=>{const o=document.createElement("div");o.className="panel-item",o.style.borderBottom="1px solid #eee",o.style.paddingBottom="6px";const n=document.createElement("div");n.textContent=e.title||"(no name)",n.style.fontWeight="600";const i=document.createElement("div");i.textContent=`${e.city||""} ${e.country?"/ "+e.country:""} ‚Ä¢ ${e.category||""}`,i.style.fontSize="12px",i.style.color="#444";const a=document.createElement("div");a.textContent=e.message||"",a.style.fontSize="13px",a.style.marginTop="4px";const r=document.createElement("div");r.style.marginTop="6px";const l=document.createElement("button");l.textContent="Edit",l.style.marginRight="6px";const u=document.createElement("button");u.textContent="Delete",r.appendChild(l),r.appendChild(u),o.appendChild(n),o.appendChild(i),o.appendChild(a),o.appendChild(r),u.addEventListener("click",async()=>{if(!confirm("Are you sure you want to delete this item?"))return;const c=g?g.uid:null,h=e.createdBy||e.ownerId||e.authorUid||null;if(I!=="admin"&&c!==h){alert("You do not have permission to delete this item.");return}try{const s=await ye(()=>import("./firebase-client-Bklma2ql.js"),__vite__mapDeps([0,1]));if(s.deleteSuggestion){if(await s.deleteSuggestion(e.id),C&&C[e.id]){try{d.removeLayer(C[e.id])}catch{}delete C[e.id]}o.parentNode&&o.parentNode.removeChild(o)}else alert("Server delete not supported.")}catch(s){console.error("delete error",s),alert("Delete failed: "+(s&&s.message?s.message:"unknown error"))}}),l.addEventListener("click",()=>{const c=document.createElement("input");c.value=e.title||"";const h=document.createElement("textarea");h.value=e.message||"";const s=document.createElement("select");["food","drink","event"].forEach(R=>{const x=document.createElement("option");x.value=R,x.textContent=R,R===e.category&&(x.selected=!0),s.appendChild(x)});const ne=document.createElement("button");ne.textContent="Save";const oe=document.createElement("button");oe.textContent="Cancel",oe.style.marginLeft="6px",o.innerHTML="",o.appendChild(c),o.appendChild(s),o.appendChild(h),o.appendChild(ne),o.appendChild(oe),ne.addEventListener("click",async()=>{const R={title:c.value,message:h.value,category:s.value};try{const x=await ye(()=>import("./firebase-client-Bklma2ql.js"),__vite__mapDeps([0,1]));if(x.updateSuggestion){if(await x.updateSuggestion(e.id,R),C&&C[e.id])try{const ie=C[e.id],ae=document.createElement("div"),D=typeof j=="function"?j:Le=>Le;ae.innerHTML=`<strong>${D(R.title)}</strong><br/><em>${D(e.city||"")}, ${D(e.country||"")}</em>
                    <div style="font-size:12px;margin-top:6px">${D(e.timeSlot||"")} / ${D(R.category||"")}</div>`;const re=document.createElement("button");re.textContent="Report",re.style.marginTop="8px",re.addEventListener("click",async()=>{try{await Fe(e.id,"Inappropriate content"),alert("Report submitted.")}catch{alert("Failed to submit report.")}}),ae.appendChild(document.createElement("hr")),ae.appendChild(re),ie.unbindPopup(),ie.bindPopup(ae)}catch(ie){console.warn("Failed to update marker popup",ie)}q()}else alert("Server update not supported.")}catch(x){console.error("update error",x),alert("Update failed: "+(x&&x.message?x.message:"unknown error"))}}),oe.addEventListener("click",()=>{q()})}),V.appendChild(o)})}}Se(le,async t=>{if(g=t,t)try{I=await Ce(t.uid)}catch(e){console.error("Failed to fetch role on auth change",e),I=null}else I=null;g?(me(),p&&(p.style.display=""),q()):(p&&(p.style.display="none"),ge())})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Be):Be();document.addEventListener("DOMContentLoaded",()=>{const H=document.getElementById("guest-btn");H&&H.addEventListener("click",()=>{localStorage.setItem("guest","true"),window.location.href="map.html?guest=true"})});const Pe=new URLSearchParams(window.location.search),Ue=Pe.get("guest");Ue||ye(()=>import("./main-DHt8C1BT.js"),__vite__mapDeps([2,3,4]));
